<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Budget App</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <nav class="navbar">
        <div class="nav-links">
            <a href="#" class="nav-link active" data-section="dashboard">Dashboard</a>
            <a href="#" class="nav-link" data-section="budget">Budget</a>
            <a href="#" class="nav-link" data-section="transactions">Transactions</a>
            <a href="#" class="nav-link" data-section="categories">Categories</a>
            <a href="#" class="nav-link" data-section="sources">Sources</a>
        </div>
    </nav>

    <main class="container">
        <!-- Dashboard Section -->
        <section id="dashboard" class="section">
            <div class="section-header">
                <h2>Dashboard</h2>
                <div class="month-selector">
                    <button id="prev-month-dashboard">&lt; Prev</button>
                    <span id="current-month-dashboard"></span>
                    <button id="next-month-dashboard">Next &gt;</button>
                </div>
            </div>
            <div class="summary-cards">
                <div class="card">
                    <h3>Total Income</h3>
                    <p id="total-income-dashboard">$0.00</p>
                </div>
                <div class="card">
                    <h3>Total Expenses</h3>
                    <p id="total-expenses-dashboard">$0.00</p>
                </div>
                <div class="card">
                    <h3>Net Balance</h3>
                    <p id="net-balance-dashboard">$0.00</p>
                </div>
            </div>
            <div class="card">
                <h3>Category Breakdown</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Actual Spent</th>
                            <th>Budgeted</th>
                            <th>Difference</th>
                        </tr>
                    </thead>
                    <tbody id="category-breakdown-body">
                        <!-- Rows will be injected by JS -->
                    </tbody>
                </table>
            </div>
            <div class="card">
                <h3>Data Management</h3>
                <p>Save your data to a file for backup or to transfer to another browser.</p>
                <div class="data-management-actions">
                    <button id="export-data-btn" class="btn">Export All Data</button>
                    <button id="import-data-btn" class="btn">Import Data</button>
                    <input type="file" id="import-data-input" class="hidden" accept=".json">
                </div>
            </div>
        </section>

        <!-- Budget Section -->
        <section id="budget" class="section hidden">
            <div class="section-header">
                <h2>Monthly Budget</h2>
                 <div class="month-selector">
                    <button id="prev-month-budget">&lt; Prev</button>
                    <span id="current-month-budget"></span>
                    <button id="next-month-budget">Next &gt;</button>
                </div>
            </div>
            <div class="card">
                <table class="table">
                    <thead>
                        <tr>
                            <th>Category</th>
                            <th>Budgeted</th>
                            <th>Actual</th>
                            <th>Difference</th>
                        </tr>
                    </thead>
                    <tbody id="budget-table-body">
                        <!-- Rows will be injected by JS -->
                    </tbody>
                </table>
                <button id="save-budget-btn" class="btn btn-primary">Save Budget</button>
            </div>
        </section>

        <!-- Transactions Section -->
        <section id="transactions" class="section hidden">
            <div class="section-header">
                <h2>Transactions</h2>
                 <div class="month-selector">
                    <button id="prev-month-transactions">&lt; Prev</button>
                    <span id="current-month-transactions"></span>
                    <button id="next-month-transactions">Next &gt;</button>
                </div>
            </div>
            <div class="card">
                <div class="transaction-actions">
                    <button id="add-transaction-btn" class="btn btn-primary">Add Transaction</button>
                    <button id="import-csv-btn" class="btn">Import CSV</button>
                    <button id="clear-all-transactions-btn" class="btn btn-danger">Clear All</button>
                </div>
                
                <!-- Filter Panel -->
                <div class="filter-panel">
                    <h4>Filter Transactions</h4>
                    <div class="filter-grid">
                        <div class="form-group">
                            <label for="filter-from-date">From Date</label>
                            <input type="date" id="filter-from-date" class="form-input">
                        </div>
                        <div class="form-group">
                            <label for="filter-to-date">To Date</label>
                            <input type="date" id="filter-to-date" class="form-input">
                        </div>
                        <div class="form-group">
                            <label for="filter-source">Source</label>
                            <select id="filter-source" class="form-input">
                                <option value="all">All Sources</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="filter-category">Category</label>
                            <select id="filter-category" class="form-input">
                                <option value="all">All Categories</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="filter-type">Type</label>
                            <select id="filter-type" class="form-input">
                                <option value="all">All Types</option>
                                <option value="income">Income</option>
                                <option value="expense">Expense</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="filter-import-type">Import Type</label>
                            <select id="filter-import-type" class="form-input">
                                <option value="all">All Import Types</option>
                                <option value="manual">Manual</option>
                                <option value="imported">Imported</option>
                            </select>
                        </div>
                    </div>
                    <button id="clear-filters-btn" class="btn">Clear Filters</button>
                </div>
                
                <input type="text" id="transaction-filter" placeholder="Filter by description..." class="form-input">
                
                <!-- Bulk Actions -->
                <div class="bulk-actions">
                    <button id="delete-selected-btn" class="btn btn-danger" disabled>Delete Selected (0)</button>
                </div>
                
                <table class="table">
                    <thead>
                        <tr>
                            <th><input type="checkbox" id="select-all-transactions"></th>
                            <th class="sortable" data-column="date">Date <span class="sort-indicator"></span></th>
                            <th class="sortable" data-column="description">Description <span class="sort-indicator"></span></th>
                            <th class="sortable" data-column="category">Category <span class="sort-indicator"></span></th>
                            <th class="sortable" data-column="type">Type <span class="sort-indicator"></span></th>
                            <th class="sortable" data-column="amount">Amount <span class="sort-indicator"></span></th>
                            <th class="sortable" data-column="source">Source <span class="sort-indicator"></span></th>
                            <th class="sortable" data-column="importType">Import Type <span class="sort-indicator"></span></th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="transactions-table-body">
                        <!-- Rows will be injected by JS -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Categories Section -->
        <section id="categories" class="section hidden">
            <div class="section-header">
                <h2>Categories</h2>
            </div>
            <div class="card">
                <h3>Manage Categories</h3>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Category Name</th>
                            <th>Active?</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="categories-table-body">
                        <!-- Rows will be injected by JS -->
                    </tbody>
                </table>
                <h3>Add New Category</h3>
                <div class="add-category-form">
                    <input type="text" id="new-category-name" placeholder="New category name" class="form-input">
                    <button id="add-category-btn" class="btn btn-primary">Add Category</button>
                </div>
            </div>
        </section>
        
        <!-- Sources Section -->
        <section id="sources" class="section hidden">
            <div class="section-header">
                <h2>Sources</h2>
            </div>
            <div class="card">
                <h3>Manage Sources</h3>
                <p style="color: #666; font-size: 0.9em;">Sources represent financial institutions like banks or credit card companies.</p>
                <table class="table">
                    <thead>
                        <tr>
                            <th>Source Name</th>
                            <th>Active?</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="sources-table-body">
                        <!-- Rows will be injected by JS -->
                    </tbody>
                </table>
                <h3>Add New Source</h3>
                <div class="add-category-form">
                    <input type="text" id="new-source-name" placeholder="New source name" class="form-input">
                    <button id="add-source-btn" class="btn btn-primary">Add Source</button>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Modals -->
    <div id="transaction-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h3 id="modal-title">Add Transaction</h3>
            <form id="transaction-form">
                <input type="hidden" id="transaction-id">
                <div class="form-group">
                    <label for="transaction-date">Date</label>
                    <input type="date" id="transaction-date" class="form-input" required>
                </div>
                <div class="form-group">
                    <label for="transaction-description">Description</label>
                    <input type="text" id="transaction-description" class="form-input" required>
                </div>
                <div class="form-group">
                    <label for="transaction-amount">Amount</label>
                    <input type="number" id="transaction-amount" class="form-input" min="0" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="transaction-type">Type</label>
                    <select id="transaction-type" class="form-input" required>
                        <option value="expense">Expense</option>
                        <option value="income">Income</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="transaction-category">Category</label>
                    <select id="transaction-category" class="form-input" required>
                        <!-- Options will be injected by JS -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="transaction-source">Source</label>
                    <select id="transaction-source" class="form-input" required>
                        <!-- Options will be injected by JS -->
                    </select>
                </div>
                <button type="submit" class="btn btn-primary">Save Transaction</button>
            </form>
        </div>
    </div>
    
    <div id="csv-import-modal" class="modal hidden">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <h3>Import CSV</h3>
            <p style="font-size: 0.9em; color: #666; margin-bottom: 10px;">
                <strong>Supported formats:</strong> CSV files with headers. Date format: MM/DD/YYYY. 
                Amount can be positive/negative. Quoted fields and various line endings (CRLF, LF) are supported.
            </p>
            <input type="file" id="csv-file-input" accept=".csv" style="display: none;">
            <button id="trigger-csv-input" class="btn">Choose CSV File</button>
            <div id="csv-preview-area" class="hidden">
                <h4>CSV Preview</h4>
                <div id="csv-validation-summary" class="hidden" style="padding: 10px; margin: 10px 0; background: #f0f0f0; border-radius: 4px;">
                    <!-- Validation summary will be inserted here -->
                </div>
                <div style="max-height: 300px; overflow-y: auto;">
                    <table class="table">
                        <thead id="csv-preview-head"></thead>
                        <tbody id="csv-preview-body"></tbody>
                    </table>
                </div>
                <h4>Map Columns</h4>
                <div class="csv-mapping">
                     <div class="form-group">
                        <label for="csv-date-col">Date Column</label>
                        <select id="csv-date-col" class="form-input"></select>
                    </div>
                     <div class="form-group">
                        <label for="csv-description-col">Description Column</label>
                        <select id="csv-description-col" class="form-input"></select>
                    </div>
                     <div class="form-group">
                        <label for="csv-amount-col">Amount Column</label>
                        <select id="csv-amount-col" class="form-input"></select>
                    </div>
                </div>
                 <h4>Import Options</h4>
                <div class="form-group">
                    <label for="csv-amount-sign-logic">Amount Sign Logic</label>
                    <p style="font-size: 0.85em; color: #666; margin: 5px 0;">How are expenses represented in your CSV?</p>
                    <select id="csv-amount-sign-logic" class="form-input">
                        <option value="negative">Expenses are negative numbers (default)</option>
                        <option value="positive">Expenses are positive numbers</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="csv-default-type">Default Type for Imported Rows</label>
                    <p style="font-size: 0.85em; color: #666; margin: 5px 0;">Used when amount is zero or sign logic doesn't determine type</p>
                    <select id="csv-default-type" class="form-input">
                        <option value="expense">Expense</option>
                        <option value="income">Income</option>
                    </select>
                </div>
                 <div class="form-group">
                    <label for="csv-default-category">Default Category for Imported Rows</label>
                    <select id="csv-default-category" class="form-input"></select>
                </div>
                <div class="form-group">
                    <label for="csv-source">Source</label>
                    <p style="font-size: 0.85em; color: #666; margin: 5px 0;">Select the financial institution for this import</p>
                    <select id="csv-source" class="form-input"></select>
                </div>
                <button id="import-csv-confirm-btn" class="btn btn-primary">Import Transactions</button>
            </div>
        </div>
    </div>


    <script src="csv-parser.js"></script>
    <script src="app.js" defer></script>
</body>
</html>